<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta content="width=device-width, initial-scale=1" name="viewport" />
    <title>Coastal Threat Alert System</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link
        href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css"
        rel="stylesheet"
    />
    <link
        href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap"
        rel="stylesheet"
    />
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        body {
            font-family: "Roboto", sans-serif;
        }
        #map {
            width: 100%;
            height: 400px;
        }
        #street-view {
            width: 100%;
            height: 400px;
            margin-top: 1rem;
            background-color: #f0f0f0;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
        }
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 25px;
            border-radius: 5px;
            color: white;
            font-weight: bold;
            z-index: 1000;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
            display: none;
        }
        .success {
            background-color: #4CAF50;
        }
        .error {
            background-color: #f44336;
        }
    </style>
</head>
<body class="bg-gray-100 min-h-screen flex flex-col">
    <!-- Notification for SMS alerts -->
    <div id="notification" class="notification"></div>

    <header class="bg-blue-900 text-white shadow-md">
        <div
            class="container mx-auto px-4 py-4 flex flex-col md:flex-row items-center justify-between"
        >
            <div class="flex items-center space-x-3">
                <img
                    alt="Logo of Coastal Threat Alert System, a stylized blue wave with a red alert icon"
                    class="w-12 h-12"
                    height="50"
                    src="https://storage.googleapis.com/a1aa/image/bda07d5a-ccf8-4b2a-a866-fedcbd562418.jpg"
                    width="50"
                />
                <h1 class="text-2xl font-bold">Coastal Threat Alert System</h1>
            </div>
            <nav class="mt-3 md:mt-0">
                <ul class="flex space-x-6 text-lg font-semibold">
                    <li><a class="hover:text-yellow-400 transition" href="#alerts">Alerts</a></li>
                    <li><a class="hover:text-yellow-400 transition" href="#news">News</a></li>
                    <li><a class="hover:text-yellow-400 transition" href="#map-section">Map</a></li>
                    <li><a class="hover:text-yellow-400 transition" href="#about">About</a></li>
                    <li>
                        <button
                            id="btn-login-open"
                            class="hover:text-yellow-400 transition focus:outline-none"
                        >
                            <i class="fas fa-user-circle"></i> Login
                        </button>
                    </li>
                </ul>
            </nav>
        </div>
    </header>
    <main class="flex-grow container mx-auto px-4 py-8 space-y-12">
        <!-- Alerts Section -->
        <section class="bg-white rounded-lg shadow p-6" id="alerts">
            <h2 class="text-3xl font-bold mb-6 text-blue-900">
                Current Coastal Threat Alerts
            </h2>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <article class="border-l-8 border-red-600 bg-red-50 p-4 rounded shadow-sm">
                    <h3 class="text-xl font-semibold text-red-700 mb-2">
                        Hurricane Warning - Gulf Coast
                    </h3>
                    <p class="text-gray-700">
                        A Category 4 hurricane is approaching the Gulf Coast with expected
                        landfall within 48 hours. Residents are advised to evacuate low-lying
                        areas immediately.
                    </p>
                </article>
                <article class="border-l-8 border-yellow-500 bg-yellow-50 p-4 rounded shadow-sm">
                    <h3 class="text-xl font-semibold text-yellow-700 mb-2">
                        High Tide Flooding - East Coast
                    </h3>
                    <p class="text-gray-700">
                        Unusually high tides expected over the next 3 days causing minor
                        flooding in coastal communities. Stay alert and avoid flooded roads.
                    </p>
                </article>
                <article class="border-l-8 border-blue-600 bg-blue-50 p-4 rounded shadow-sm">
                    <h3 class="text-xl font-semibold text-blue-700 mb-2">
                        Tsunami Watch - Pacific Islands
                    </h3>
                    <p class="text-gray-700">
                        A tsunami watch has been issued following a 7.8 magnitude earthquake
                        near the Pacific Islands. Monitor local authorities for updates.
                    </p>
                </article>
            </div>
        </section>
        <!-- News Section -->
        <section class="bg-white rounded-lg shadow p-6" id="news">
            <h2 class="text-3xl font-bold mb-6 text-blue-900">Latest Coastal News</h2>
            <div class="space-y-6">
                <article
                    class="flex flex-col md:flex-row bg-gray-50 rounded shadow overflow-hidden"
                >
                    <img
                        alt="Aerial view of coastal town damaged by recent storm with debris and flooding"
                        class="w-full md:w-48 object-cover"
                        height="200"
                        src="https://storage.googleapis.com/a1aa/image/ffe45af9-7917-4873-8108-e94631dff1ae.jpg"
                        width="300"
                    />
                    <div class="p-4 flex flex-col justify-between">
                        <h3 class="text-xl font-semibold text-blue-800 mb-2">
                            Storm Causes Widespread Damage Along Coast
                        </h3>
                        <p class="text-gray-700 flex-grow">
                            Recent storms have caused significant damage to coastal infrastructure,
                            with emergency services working around the clock to assist affected
                            residents.
                        </p>
                        <time class="text-sm text-gray-500 mt-2" datetime="2024-06-10">
                            June 10, 2024
                        </time>
                    </div>
                </article>
                <article
                    class="flex flex-col md:flex-row bg-gray-50 rounded shadow overflow-hidden"
                >
                    <img
                        alt="Volunteers cleaning up a beach coastline with bags of trash and sunny weather"
                        class="w-full md:w-48 object-cover"
                        height="200"
                        src="https://storage.googleapis.com/a1aa/image/172963c2-c8c9-4487-307d-0fea0e605df3.jpg"
                        width="300"
                    />
                    <div class="p-4 flex flex-col justify-between">
                        <h3 class="text-xl font-semibold text-blue-800 mb-2">
                            Community Organizes Coastal Cleanup Event
                        </h3>
                        <p class="text-gray-700 flex-grow">
                            Hundreds of volunteers gathered to remove debris and plastic waste from
                            the shoreline, helping to protect marine life and improve coastal
                            health.
                        </p>
                        <time class="text-sm text-gray-500 mt-2" datetime="2024-06-08">
                            June 8, 2024
                        </time>
                    </div>
                </article>
                <article
                    class="flex flex-col md:flex-row bg-gray-50 rounded shadow overflow-hidden"
                >
                    <img
                        alt="Satellite image showing storm formation over the ocean with swirling clouds"
                        class="w-full md:w-48 object-cover"
                        height="200"
                        src="https://storage.googleapis.com/a1aa/image/5c7819b5-0083-4863-2d6a-8ec3e60e14ef.jpg"
                        width="300"
                    />
                    <div class="p-4 flex flex-col justify-between">
                        <h3 class="text-xl font-semibold text-blue-800 mb-2">
                            Satellite Detects New Storm Formation
                        </h3>
                        <p class="text-gray-700 flex-grow">
                            Meteorologists are monitoring a new storm system developing over the
                            Atlantic Ocean, with potential to impact coastal regions in the coming
                            days.
                        </p>
                        <time class="text-sm text-gray-500 mt-2" datetime="2024-06-07">
                            June 7, 2024
                        </time>
                    </div>
                </article>
            </div>
        </section>
        <!-- Map Section -->
        <section class="bg-white rounded-lg shadow p-6" id="map-section">
            <h2 class="text-3xl font-bold mb-6 text-blue-900">Interactive Coastal Map</h2>
            <p class="mb-4 text-gray-700">
                Select any text containing a location name anywhere on this page, and the
                map will zoom to that location. Use the buttons below to switch map views.
            </p>
            <div class="flex flex-col md:flex-row md:space-x-6">
                <div class="flex-1">
                    <div class="rounded shadow" id="map"></div>
                    <div
                        class="mt-4 flex flex-wrap gap-3 justify-center md:justify-start"
                        role="group"
                        aria-label="Map view options"
                    >
                        <button
                            aria-label="Switch to Map View"
                            class="px-4 py-2 bg-blue-700 text-white rounded hover:bg-blue-800 transition"
                            id="btn-map"
                            type="button"
                        >
                            <i class="fas fa-map"></i> Map View
                        </button>
                        <button
                            aria-label="Switch to Satellite View"
                            class="px-4 py-2 bg-gray-700 text-white rounded hover:bg-gray-800 transition"
                            id="btn-satellite"
                            type="button"
                        >
                            <i class="fas fa-globe"></i> Satellite View
                        </button>
                        <button
                            aria-label="Switch to Terrain View"
                            class="px-4 py-2 bg-green-700 text-white rounded hover:bg-green-800 transition"
                            id="btn-terrain"
                            type="button"
                        >
                            <i class="fas fa-mountain"></i> Terrain View
                        </button>
                        <button
                            aria-label="Toggle Street View"
                            class="px-4 py-2 bg-indigo-700 text-white rounded hover:bg-indigo-800 transition"
                            id="btn-street"
                            type="button"
                        >
                            <i class="fas fa-street-view"></i> Street View
                        </button>
                    </div>
                </div>
                <div class="flex-1 mt-6 md:mt-0">
                    <div class="rounded shadow hidden" id="street-view">
                        <i class="fas fa-street-view text-6xl text-gray-400 mb-4"></i>
                        <p class="text-gray-600 text-center">Street View</p>
                        <p class="text-gray-500 text-sm text-center mt-2">Select a location on the map to enable street view</p>
                    </div>
                </div>
            </div>
        </section>
        <!-- About Section -->
        <section class="bg-white rounded-lg shadow p-6" id="about">
            <h2 class="text-3xl font-bold mb-6 text-blue-900">
                About Coastal Threat Alert System
            </h2>
            <p class="text-gray-700 max-w-4xl">
                The Coastal Threat Alert System (CTA) is a comprehensive platform designed
                to provide real-time alerts, news, and interactive mapping for coastal
                threats such as hurricanes, tsunamis, flooding, and other natural hazards.
                Our mission is to empower coastal communities with timely information to
                enhance preparedness and safety.
            </p>
            <p class="text-gray-700 max-w-4xl mt-4">
                This system integrates advanced mapping technologies including interactive maps
                with multiple viewing options such as street view, terrain, and satellite
                imagery. Users can interact with the map by selecting location text
                anywhere on the site, instantly visualizing the area of interest.
            </p>
            <p class="text-gray-700 max-w-4xl mt-4">
                Developed by a dedicated team of experts, CTA combines data, technology,
                and community engagement to help mitigate the impact of coastal threats.
            </p>
        </section>
    </main>
    <footer class="bg-blue-900 text-white py-6 mt-12">
        <div class="container mx-auto px-4 text-center text-sm">
            © 2024 Coastal Threat Alert System. All rights reserved.
        </div>
    </footer>
    <!-- Login Modal -->
    <div
        aria-hidden="true"
        class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden"
        id="login-modal"
    >
        <div class="bg-white rounded-lg shadow-lg w-full max-w-md p-6 relative">
            <button
                aria-label="Close login modal"
                class="absolute top-3 right-3 text-gray-600 hover:text-gray-900 focus:outline-none"
                id="btn-login-close"
                type="button"
            >
                <i class="fas fa-times fa-lg"></i>
            </button>
            <h2 class="text-2xl font-bold mb-4 text-blue-900 text-center">User Login</h2>
            <form id="login-form" class="space-y-4" novalidate>
                <div>
                    <label
                        class="block text-gray-700 font-semibold mb-1"
                        for="username"
                    >Username</label
                    >
                    <input
                        autocomplete="username"
                        class="w-full border border-gray-300 rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-600"
                        id="username"
                        name="username"
                        required
                        type="text"
                        aria-required="true"
                    />
                </div>
                <div>
                    <label
                        class="block text-gray-700 font-semibold mb-1"
                        for="phone"
                    >Phone Number (for SMS alerts)</label
                    >
                    <input
                        autocomplete="tel"
                        class="w-full border border-gray-300 rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-600"
                        id="phone"
                        name="phone"
                        pattern="^\+?[0-9]{7,15}$"
                        placeholder="+1234567890"
                        required
                        type="tel"
                        aria-required="true"
                    />
                </div>
                <div>
                    <label
                        class="block text-gray-700 font-semibold mb-1"
                        for="location"
                    >Your Coastal Area (City, State, or Region)</label
                    >
                    <input
                        autocomplete="off"
                        class="w-full border border-gray-300 rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-600"
                        id="location"
                        name="location"
                        placeholder="e.g. Miami, FL"
                        required
                        type="text"
                        aria-required="true"
                    />
                </div>
                <button
                    class="w-full bg-blue-700 text-white py-2 rounded hover:bg-blue-800 transition font-semibold"
                    type="submit"
                >
                    Save & Subscribe
                </button>
            </form>
            <p class="mt-3 text-sm text-gray-600 text-center">
                Your data is stored locally in your browser for demo purposes.
            </p>
        </div>
    </div>

    <!-- Leaflet JS -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    
    <script>
        document.addEventListener("DOMContentLoaded", () => {
            let map;
            let currentView = "map"; // map, satellite, terrain, street
            const mapElement = document.getElementById("map");
            const streetViewElement = document.getElementById("street-view");
            
            // Default center: Atlantic Ocean near US East Coast
            const defaultCenter = [30.0, -80.0];
            
            // Map layers
            const mapLayer = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
            });
            
            const satelliteLayer = L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {
                attribution: '&copy; <a href="https://www.esri.com/">Esri</a>'
            });
            
            const terrainLayer = L.tileLayer('https://{s}.tile.opentopomap.org/{z}/{x}/{y}.png', {
                attribution: 'Map data: &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors, <a href="http://viewfinderpanoramas.org">SRTM</a> | Map style: &copy; <a href="https://opentopomap.org">OpenTopoMap</a>'
            });
            
            // Initialize map
            function initializeMap() {
                map = L.map('map').setView(defaultCenter, 5);
                mapLayer.addTo(map);
                
                // Add a marker for default location
                L.marker(defaultCenter).addTo(map)
                    .bindPopup('Default Location: Atlantic Ocean')
                    .openPopup();
            }
            
            // Set map type
            function setMapType(type) {
                if (!map) return;
                
                // Remove current layer
                map.eachLayer(layer => {
                    if (layer instanceof L.TileLayer) {
                        map.removeLayer(layer);
                    }
                });
                
                // Add new layer
                switch (type) {
                    case "map":
                        mapLayer.addTo(map);
                        break;
                    case "satellite":
                        satelliteLayer.addTo(map);
                        break;
                    case "terrain":
                        terrainLayer.addTo(map);
                        break;
                }
            }
            
            // Toggle street view
            function toggleStreetView() {
                if (currentView === "street") {
                    streetViewElement.classList.add("hidden");
                    mapElement.classList.remove("hidden");
                    currentView = "map";
                } else {
                    streetViewElement.classList.remove("hidden");
                    mapElement.classList.add("hidden");
                    currentView = "street";
                }
            }
            
            // Mock geocoding function
            function geocodeAddress(address) {
                return new Promise((resolve, reject) => {
                    // Mock locations for demo purposes
                    const mockLocations = {
                        "gulf coast": [29.0, -90.0],
                        "east coast": [36.0, -75.0],
                        "pacific islands": [-15.0, -170.0],
                        "miami": [25.7617, -80.1918],
                        "new orleans": [29.9511, -90.0715],
                        "los angeles": [34.0522, -118.2437],
                        "seattle": [47.6062, -122.3321],
                        "boston": [42.3601, -71.0589]
                    };
                    
                    const normalizedAddress = address.toLowerCase().trim();
                    
                    // Check if we have a mock location for this address
                    for (const [key, coords] of Object.entries(mockLocations)) {
                        if (normalizedAddress.includes(key)) {
                            resolve({ lat: coords[0], lng: coords[1] });
                            return;
                        }
                    }
                    
                    // Default to a random coastal location if not found
                    const coastalLocations = [
                        [30.0, -80.0], // Atlantic
                        [25.0, -80.0], // Florida
                        [35.0, -120.0], // California
                        [45.0, -123.0], // Oregon
                        [21.0, -157.0], // Hawaii
                    ];
                    
                    const randomLocation = coastalLocations[Math.floor(Math.random() * coastalLocations.length)];
                    resolve({ lat: randomLocation[0], lng: randomLocation[1] });
                });
            }
            
            // Focus location on map
            function focusLocation(location) {
                if (!map) return;
                map.setView([location.lat, location.lng], 12);
                
                // Add a marker for the location
                L.marker([location.lat, location.lng]).addTo(map)
                    .bindPopup(`Location: ${location.lat.toFixed(4)}, ${location.lng.toFixed(4)}`)
                    .openPopup();
                
                if (currentView === "street") {
                    toggleStreetView();
                }
            }
            
            // Initialize map when DOM is loaded
            initializeMap();
            
            // Map view buttons
            document.getElementById("btn-map").addEventListener("click", () => {
                if (!map) return;
                setMapType("map");
                if (currentView === "street") {
                    toggleStreetView();
                }
            });
            
            document.getElementById("btn-satellite").addEventListener("click", () => {
                if (!map) return;
                setMapType("satellite");
                if (currentView === "street") {
                    toggleStreetView();
                }
            });
            
            document.getElementById("btn-terrain").addEventListener("click", () => {
                if (!map) return;
                setMapType("terrain");
                if (currentView === "street") {
                    toggleStreetView();
                }
            });
            
            document.getElementById("btn-street").addEventListener("click", () => {
                toggleStreetView();
            });
            
            // Listen for text selection anywhere on the page
            document.body.addEventListener("mouseup", async () => {
                const selection = window.getSelection();
                if (!selection) return;
                const selectedText = selection.toString().trim();
                if (selectedText.length < 3) return;
                
                try {
                    const location = await geocodeAddress(selectedText);
                    focusLocation(location);
                } catch (error) {
                    console.log("Location not found:", error);
                }
            });
            
            // Login modal controls
            const loginModal = document.getElementById("login-modal");
            const btnLoginOpen = document.getElementById("btn-login-open");
            const btnLoginClose = document.getElementById("btn-login-close");
            const loginForm = document.getElementById("login-form");
            
            btnLoginOpen.addEventListener("click", () => {
                loginModal.classList.remove("hidden");
                document.body.style.overflow = "hidden";
            });
            
            btnLoginClose.addEventListener("click", () => {
                loginModal.classList.add("hidden");
                document.body.style.overflow = "";
            });
            
            loginModal.addEventListener("click", (e) => {
                if (e.target === loginModal) {
                    loginModal.classList.add("hidden");
                    document.body.style.overflow = "";
                }
            });
            
            // User data storage and SMS alert simulation
            function saveUserData(user) {
                let users = JSON.parse(localStorage.getItem("cta_users")) || [];
                const index = users.findIndex((u) => u.username === user.username);
                if (index !== -1) {
                    users[index] = user;
                } else {
                    users.push(user);
                }
                localStorage.setItem("cta_users", JSON.stringify(users));
            }
            
            // Alert zones as circles with center lat/lng and radius in km
            const alertZones = [
                {
                    id: "hurricane-gulf",
                    name: "Hurricane Warning - Gulf Coast",
                    center: { lat: 29.0, lng: -90.0 },
                    radiusKm: 150,
                    message:
                        "Hurricane Warning: Evacuate low-lying areas immediately!",
                },
                {
                    id: "high-tide-east",
                    name: "High Tide Flooding - East Coast",
                    center: { lat: 36.0, lng: -75.0 },
                    radiusKm: 100,
                    message: "High Tide Flooding Alert: Stay alert and avoid flooded roads.",
                },
                {
                    id: "tsunami-pacific",
                    name: "Tsunami Watch - Pacific Islands",
                    center: { lat: -15.0, lng: -170.0 },
                    radiusKm: 200,
                    message: "Tsunami Watch: Monitor local authorities for updates.",
                },
            ];
            
            // Haversine formula to calculate distance between two lat/lng points in km
            function getDistanceKm(lat1, lng1, lat2, lng2) {
                const R = 6371; // Earth radius km
                const dLat = ((lat2 - lat1) * Math.PI) / 180;
                const dLng = ((lng2 - lng1) * Math.PI) / 180;
                const a =
                    Math.sin(dLat / 2) * Math.sin(dLat / 2) +
                    Math.cos((lat1 * Math.PI) / 180) *
                    Math.cos((lat2 * Math.PI) / 180) *
                    Math.sin(dLng / 2) *
                    Math.sin(dLng / 2);
                const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
                return R * c;
            }
            
            // Check if user location is inside any alert zone
            function checkUserAlerts(user) {
                if (!user.locationLatLng) return [];
                const alerts = [];
                alertZones.forEach((zone) => {
                    const dist = getDistanceKm(
                        user.locationLatLng.lat,
                        user.locationLatLng.lng,
                        zone.center.lat,
                        zone.center.lng
                    );
                    if (dist <= zone.radiusKm) {
                        alerts.push(zone);
                    }
                });
                return alerts;
            }
            
            // Show notification
            function showNotification(message, type) {
                const notification = document.getElementById("notification");
                notification.textContent = message;
                notification.className = "notification " + type;
                notification.style.display = "block";
                
                // Hide after 5 seconds
                setTimeout(() => {
                    notification.style.display = "none";
                }, 5000);
            }
            
            // Simulate sending SMS alert
            function sendSmsAlert(phone, message) {
                showNotification(`SMS Alert sent to ${phone}: ${message}`, "success");
                console.log(`SMS Alert sent to ${phone}: ${message}`);
            }
            
            loginForm.addEventListener("submit", async (e) => {
                e.preventDefault();
                const username = loginForm.username.value.trim();
                const phone = loginForm.phone.value.trim();
                const locationText = loginForm.location.value.trim();
                
                if (!username || !phone || !locationText) {
                    showNotification("Please fill all fields.", "error");
                    return;
                }
                
                const phonePattern = /^\+?[0-9]{7,15}$/;
                if (!phonePattern.test(phone)) {
                    showNotification(
                        "Please enter a valid phone number with country code, e.g. +1234567890",
                        "error"
                    );
                    return;
                }
                
                try {
                    const locationLatLng = await geocodeAddress(locationText);
                    const user = { username, phone, locationText, locationLatLng };
                    saveUserData(user);
                    
                    const alerts = checkUserAlerts(user);
                    if (alerts.length > 0) {
                        alerts.forEach((alertZone) => {
                            sendSmsAlert(
                                phone,
                                `Alert for your location: ${alertZone.name}\n${alertZone.message}`
                            );
                        });
                    } else {
                        showNotification(
                            "You are currently not in any alert zones. You will be notified if any alerts apply.",
                            "success"
                        );
                    }
                    
                    loginModal.classList.add("hidden");
                    document.body.style.overflow = "";
                    loginForm.reset();
                } catch (error) {
                    showNotification(
                        "Could not find the location you entered. Please enter a valid city, state, or region.",
                        "error"
                    );
                }
            });
        });
    </script>
</body>

</html>
